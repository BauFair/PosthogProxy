:80

route {
    # 1. Handle requests starting with /ingest/
    # This MUST come first inside 'route'
    handle_path /ingest/* {
        reverse_proxy https://us.i.posthog.com {
            header_up Host us.i.posthog.com
            header_up X-Real-IP {remote_host}
            header_up X-Forwarded-For {remote_host}
            header_up X-Forwarded-Proto {scheme}
        }
    }

    # 2. Handle everything else (fallback)
    handle {
        respond "Analytics proxy running" 200
    }
}
